<!DOCTYPE html>
<html lang="ja-JP">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Posts &middot; 岩手県立大学プログラミングサークル</title>

		
  		<link rel="stylesheet" href="/blog/css/style.css">
		<link rel="stylesheet" href="/blog/css/fonts.css">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">

		
		<link href="/blog/posts/index.xml" rel="alternate" type="application/rss+xml" title="岩手県立大学プログラミングサークル" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/blog/">
					<h2 class="nav-title">岩手県立大学プログラミングサークル</h2>
				</a>
				<ul>
    
    
        <li>
            <a href="/blog/about/">
                
                <span>About</span>
                
            </a>
        </li>
    
        <li>
            <a href="/blog/posts/">
                
                <span>投稿</span>
                
            </a>
        </li>
    
</ul>
			</div>
		</nav>

        

<main>
	<div class="catalogue">
		
			<a href="https://iwatepu-cpc.github.io/blog/posts/cl-cffi-vulkan_0/" class="catalogue-item">
    <div>
        <time datetime="2020-10-05 22:03:18 &#43;0900 JST" class="catalogue-time">October 5, 2020</time>
        <h1 class="catalogue-title">Common LispでCFFIでVulkanのAPIを呼ぶ</h1>
        <div class="catalogue-line"></div>

        <p>
            はじめに 仕様がオープンなグラフィックスAPI「Vulkan」がKhronos Groupから発表されて数年経つ。 公式からはC/C++のヘッダーファイルが提供され、他言語からも扱いやすくなっている。 ここで筆者は有志が作成したCommon Lisp向けのバインディング(3b/cl-vulkan)を使おうと考えたが、READMEにはTODOが並び、3年前で更新が止まっている。どうにか自力でバインディングを生やしたい。
Vulkanからはvk.xmlというAPIのインデックスのようなものも提供されており、既存のバインディングはこれをパースして自動生成しているらしい。今回はCFFIの書き方を理解するため、手動でバインディングを生成する。
CFFI(The Common Foreign Function Interface)はCommon Lispの処理系依存を吸収し、統一されたAPIで他言語で作成されたライブラリの関数等を呼び出すためのライブラリである。FFIはCommon Lispの言語仕様の範疇ではないため、処理系毎に独自実装されているのだ。
準備 普段使っているLinuxマシンではなく、ろくに環境構築していないWindows PC上でこれを書いているため、新たにCommon Lispの開発環境を準備する。
まずは処理系をインストールする。近年のモダンなプログラミング言語では処理系管理ツールが盛んに利用されているが、有難いことにCommon Lispにも同様なツールが存在する。Roswellという。名前は、&ldquo;made with secret alien technology&quot;というCommon Lispの(誰が言い出したのかは知らない)キャッチフレーズと、そこから連想されるロズウェルUFO事件に由来する。
RoswellはInstallation Guideを見ながらインストールした。Scoopは使わず、zipファイルをD:\roswellに展開してパスを通した。
これでRoswellによってCommon Lisp処理系のインストールが出来るようになったので、とりあえず最新のSBCL(2.0.0)をインストールする。
ros install sbcl-bin 以下のようにInitial Recommended Setupを済ませる。
code C:\Users\tamam\AppData\Local\config\common-lisp\source-registry.conf (:source-registry (:tree &#34;/Users/tamam/.roswell/lisp/quicklisp/dists/quicklisp/software/&#34;) :INHERIT-CONFIGURATION) CFFIを使うので、Roswellからインストールする。
ros install cffi CFFIからVulkanを触るにはvulkan-1.dllが必要だが、これはGPUドライバと一緒にインストールされる。筆者環境ではC:\Windows\System32\vulkan-1.dllに格納されていた。
Vulkan Loaderのライブラリを読み込む まずはCFFIでvulkan-1.dllを読み込む。
(ql:quickload :cffi) (defpackage vkffi (:use :cl :cffi)) (in-package vkffi) (define-foreign-library vulkan (:windows &#34;vulkan-1.dll&#34;)) (use-foreign-library vulkan) ここまでを実行してエラーが表示されなければ問題ない。
実行する関数のシグネチャをチェック 今回はvkEnumerateInstanceExtensionPropertiesを実行してみる。これはレイヤー毎に有効化可能な拡張の一覧を取得する関数である。
マニュアルを読むと、戻り値がVkResult型で、引数にconst char*とuint32_tとVkExtensionProperties*を取ることが示されている。CFFIではビルトイン型は当然扱えるため、そうでないものに注目する。
 VkResult VkExtensionProperties  それぞれ列挙型と構造体であることが分かる。まずはこれをCFFIで定義する。名前は合わせなくても良い。
        </p>
    </div>
</a>

		
			<a href="https://iwatepu-cpc.github.io/blog/posts/0/" class="catalogue-item">
    <div>
        <time datetime="2020-10-05 21:29:38 &#43;0900 JST" class="catalogue-time">October 5, 2020</time>
        <h1 class="catalogue-title">当ブログについて</h1>
        <div class="catalogue-line"></div>

        <p>
            ここは、
 岩手県立大学　プログラミングサークルの 岩手県立大学　プログラミングサークルによる 岩手県立大学　プログラミングサークル以外の人のための  ブログです。
当サークルがどんな活動をしているのかをお伝えしていきます。
        </p>
    </div>
</a>

		
	</div>
	
	<div class="pagination">
		
		
	
		<span>1</span>
	</div>
</main>


        		<footer>
			
			<span>
			&copy; <time datetime="2020-10-05 22:05:40.668005 &#43;0900 JST m=&#43;0.535740401">2020</time> . Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
